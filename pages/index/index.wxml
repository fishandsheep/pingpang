<view class="container">
  <map
    class="map {{mapExpanded ? 'expanded' : ''}}"
    latitude="{{latitude}}"
    longitude="{{longitude}}"
    scale="{{scale}}"
    markers="{{markers}}"
    show-location
    bindmarkertap="onMarkerTap"
    bindregionchange="onRegionChange"
    bindtap="resetPanel"
  >
    <view class="map-controls">
      <view class="location-btn" bindtap="onLocationTap">
        <image src="/assets/location.svg" mode="aspectFit"></image>
      </view>
      
      <view class="refresh-btn" bindtap="onRefreshTap">
        <image src="/assets/refresh.svg" mode="aspectFit"></image>
      </view>
    </view>
  </map>
  
  <view class="top-bar">
    <view class="search-bar" bindtap="onSearchTap">
      <image class="search-icon" src="/assets/search.svg" mode="aspectFit"></image>
      <input type="text" placeholder="搜索附近球台" disabled />
    </view>
  </view>
  
  <view class="bottom-panel {{panelState}}" wx:if="{{markers.length > 0}}">
    <view class="panel-header" bindtouchstart="onDragStart" bindtouchmove="onDragMove" bindtouchend="onDragEnd">
      <view class="drag-handle"></view>
      <view class="panel-title-row">
        <text class="panel-title">附近球台 ({{markers.length}})</text>
        <view class="filter-btn {{filterStatus !== 'all' ? 'filter-active' : ''}}" bindtap="toggleFilter">
          <text class="filter-text">{{getFilterText(filterStatus)}}</text>
          <image src="/assets/filter.svg" mode="aspectFit"></image>
        </view>
      </view>
    </view>
    
    <scroll-view class="table-list" scroll-y>
      <view class="table-item" wx:for="{{markers}}" wx:key="id" bindtap="focusMarker" data-marker="{{item}}">
        <view class="table-info">
          <view class="table-name">{{item.title}}</view>
          <view class="table-address">{{item.subtitle}}</view>
          <view class="table-status">
            <text class="status-dot {{item.status === '空闲' ? 'status-free' : 'status-busy'}}"></text>
            <text class="status-text">{{item.status}}</text>
          </view>
        </view>
        <view class="table-distance">
          <text>{{item.distance || '计算中'}}</text>
          <image src="/assets/navigation.svg" mode="aspectFit"></image>
        </view>
      </view>
    </scroll-view>
  </view>
</view>